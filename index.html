<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
            width: 800,
            height: 600,
        scene: {
            preload: preload,
            create: create
        }
    };

    var game = new Phaser.Game(config);

    // The potential paths
    var newPort = {
        hasTruck: false,
        x: 346,
        y: 231,
        neighbours: []
    }
    var pointSeven = {
        hasTruck: false,
        x: 328,
        y: 182,
        neighbours: [newPort]
    }
    var pointSix = {
        hasTruck: false,
        x: 369,
        y: 114,
        neighbours: [pointSeven]
    }
    var pointFive = {
        hasTruck: false,
        x: 271,
        y: 123,
        neighbours: [pointSix]
    }
    var pointTen = {
        hasTruck: false,
        x: 296,
        y: 215,
        neighbours: [pointSeven]
    }
    var pointNine = {
        hasTruck: false,
        x: 290,
        y: 258,
        neighbours: [pointTen]
    }
    var pointEight = {
        hasTruck: false,
        x: 242,
        y: 270,
        neighbours: [pointNine]
    }
    var pointFour = {
        hasTruck: false,
        x: 261,
        y: 220,
        neighbours: [pointEight]
    }
    var pointThree = {
        hasTruck: false,
        x: 171,
        y: 148,
        neighbours: [pointFour, pointFive]
    }
    var pointTwo = {
        hasTruck: false,
        x: 147,
        y: 102,
        neighbours: [pointThree]
    }
    var pointOne = {
        hasTruck: false,
        x: 174,
        y: 48,
        neighbours: [pointTwo]
    }

    function preload ()
    {
        // load images
        this.load.image('background', 'assets/board.png');
        this.load.image('truck', 'assets/truck.png');
    }

    function create ()
    {
        let money = 0;

        let bg = this.add.sprite(0, 0, 'background');
        bg.setScale(0.2);
        bg.setOrigin(0,0);

        // 20x 20y is the lorry pool
        var truck = this.add.sprite(20, 20, 'truck', 0).setInteractive();
        truck.setScale(0.02);
        truck.on('pointerdown', function (pointer) {
            this.setTint(0xff0000);
        });

        truck.on('pointerout', function (pointer) {
            this.clearTint();
        });

        truck.on('pointerup', function (pointer) {
            this.clearTint();
            this.x = 174;
            this.y = 48;
        });

        // this.input.setDraggable(truck);

        // //  The pointer has to move 16 pixels before it's considered as a drag
        // this.input.dragDistanceThreshold = 16;

        // this.input.on('dragstart', function (pointer, selectedTruck) {
        //     selectedTruck.setTint(0xfff000);
        // });

        // this.input.on('drag', function (pointer, selectedTruck, dragX, dragY) {
        //     selectedTruck.x = dragX;
        //     selectedTruck.y = dragY;
        //     console.log(dragX)
        //     console.log(dragY)
        // });

        // this.input.on('dragend', function (pointer, selectedTruck) {
        //     selectedTruck.clearTint();
        // });
        graphics = this.add.graphics();

        // Iterate through each path and draw lines
        drawPath(pointOne)

        traversePath(pointOne, 0, 3)
    }

    // Iterative function for looping through a path
    function traversePath(node, accumulator, stopValue) {
        graphics.lineStyle(2, 0xffffff, 1);
        node.neighbours.forEach(neighbour => {
            if(accumulator != stopValue) {
                traversePath(neighbour, accumulator + 1, stopValue);
            } else {
                graphics.fillStyle(0xffffff, 1);
                graphics.fillCircle(neighbour.x, neighbour.y, 8);
            }
        });
    }

    function drawPath(node) {
        graphics.lineStyle(2, 0xffffff, 1);
        node.neighbours.forEach(neighbour => {
            graphics.fillStyle(0xffff00, 1);
            graphics.lineBetween(neighbour.x, neighbour.y, node.x, node.y);
            graphics.fillCircle(neighbour.x, neighbour.y, 8);
            drawPath(neighbour);
        });
    }
    </script>

</body>
</html>