<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
    <script type="text/javascript" src="src/truckPaths.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
            width: 800,
            height: 600,
        scene: {
            preload: preload,
            create: create
        }
    };

    var game = new Phaser.Game(config);

    function preload ()
    {
        // load images
        this.load.image('background', 'assets/background.jpg');
        this.load.image('truck', 'assets/truck.png');
        this.load.image('dice', 'assets/dice.png');
    }

    function create ()
    {
        let money = 0;
        var diceRoll = 0;

        let bg = this.add.sprite(0, 0, 'background');
        bg.setScale(0.2);
        bg.setOrigin(0,0);

        // 20x 20y is the lorry pool
        var truck = this.add.sprite(20, 20, 'truck', 0).setInteractive();
        truck.setScale(0.02);
        truck.on('pointerdown', function (pointer) {
            this.setTint(0xff0000);
        });

        truck.on('pointerout', function (pointer) {
            this.clearTint();
        });

        truck.on('pointerup', function (pointer) {
            this.clearTint();
            this.x = 174;
            this.y = 48;
        });

        var dice = this.add.sprite(20, 20, 'dice1', 0).setInteractive();
        dice.setScale(0.02);
        dice.on('pointerdown', function (pointer) {
            this.setTint(0xff0000);
        });

        dice.on('pointerout', function (pointer) {
            this.clearTint();
        });

        dice.on('pointerup', function (pointer) {
            this.clearTint();
            diceRoll = Math.floor(Math.random() * 6) + 1
            traversePath(whiteMine, 1, diceRoll)
        });
        
        // Iterate through each path and draw lines
        graphics = this.add.graphics();
        drawPath(whiteMine)
        drawPath(greenMine)
        drawPath(purpleMine)
        drawPath(blueMine)
        drawPath(redMine)
        drawPath(yellowMine)
    }

    // Iterative function for looping through a path
    function traversePath(node, accumulator, stopValue) {
        graphics.lineStyle(2, 0xffffff, 1);
        node.neighbours.forEach(neighbour => {
            if(accumulator != stopValue) {
                traversePath(neighbour, accumulator + 1, stopValue);
            } else {
                graphics.fillStyle(0xffffff, 1);
                graphics.fillCircle(neighbour.x, neighbour.y, 8);
            }
        });
    }

    function drawPath(node) {
        graphics.lineStyle(2, 0xffffff, 1);
        node.neighbours.forEach(neighbour => {
            graphics.fillStyle(0xffff00, 1);
            console.log(node.x);
            console.log(node.y);
            graphics.lineBetween(neighbour.x, neighbour.y, node.x, node.y);
            graphics.fillCircle(neighbour.x, neighbour.y, 8);
            drawPath(neighbour);
        });
    }
    </script>

</body>
</html>